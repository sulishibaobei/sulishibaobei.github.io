---
title :  文字识别
date : 2018-10-01 20:08:53
categories: "文字识别"
tag:
 - 身份证识别 
 - 人脸识别
 - 学信网识别
---
>* 最近接到一个新的需求，做证件照识别，身份证照和头像比对。
详细介绍下几点：
1.文字识别和人脸比对调用的百度云的接口[http://ai.baidu.com/forum/topic/show/867951](http://ai.baidu.com/forum/topic/show/867951)
2.本地采用nginx转发的请求。IOS拍照的时候文件体积比较大，nginx可能会报413错误（nginx 413 Request Entity Too Large ）
解决办法[https://blog.csdn.net/testcs_dn/article/details/78366272](https://blog.csdn.net/testcs_dn/article/details/78366272)
3.上传的图片全部都转成base64且需去掉前缀

####案例展示
1. 识别身份证试试
   
```html
<div class="w100 dashed">
            <p class="w30 title bold">上传身份证：</p>
            <div class="w100 tc  mt10" style="height: 130px;background: #fff">
                <div class="w50 fl relative" style="height:100%;border:1px solid #ddd">
                    <span>
                        <img src="images/front.png" alt="" style="width:60px;height: 30px;display: block;padding-left: 32%; padding-top: 13%;" />
                        <button class="btn-white relative">
                            <input type="file" accept="image/*" id="imgCard"/>上传身份证正面
                        </button>
                    </span>
                        <img src="" id="frontCard" class="w100" style="display: none">
                        <input type="hidden" id="frontCardValid" name="frontCard" />
                </div>
            </div>
        </div>
```
都是一些简单的样式，可以忽略。因为这不是重点。

```javascript
  $("body").on('change', '#imgCard', function() {
            if (this.files && this.files[0]) {
                //压缩
                var objUrl = getObjectURL(this.files[0]);
                $('#frontCard').attr('src', objUrl); //显示在界面
                $("#frontCardValid").val(objUrl);
                var image = new Image();
                image.src = objUrl;
                image.onload = function() {
                        IDCardRecognition(compress(image));
                    }
            }
    })

    function IDCardRecognition(file) {
    $.ajax({
        url: "https://aip.baidubce.com/rest/2.0/ocr/v1/idcard?  access_token=24.126331b6c9f698cf8408591f33343dab.2592000.1540865247.282335-14247222", //路径   
        type: "POST", //提交方式 
        data: {
            'id_card_side': 'front',  //代表请求的是身份证正面
            'image': file,
        },
        success: function(result) {
            var info = result.words_result;
            alert(info);
        },
        error: function(error) {
            console.log(error);
        },

    });
}
function getObjectURL(file) {
    var url = null;
    if (window.createObjectURL != undefined) { // basic
        url = window.createObjectURL(file);
    } else if (window.URL != undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file);
    } else if (window.webkitURL != undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file);
    }
    return url;
};

function compress(image) {
    var height = image.height;
    var width = image.width;
    var canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = '#FFF'; //绘制背景色
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    //0.5为压缩的质量比例，范围是0~1。
    var imgBase = canvas.toDataURL("image/jpeg", 0.5);
    var arr = imgBase.split(",");
    return arr[1];

};
```
1. 图像数据要求：base64编码后进行urlencode，要求base64编码和urlencode后大小不超过4M，最短边至少15px，最长边最大4096px,支持jpg/png/bmp格式。 
2. 手机拍照出来的文件一般比较大，记得压缩下。（ps:亲测，压缩后的文件请求返回数据一般控制在3s内。本人IOS手机拍出来的文件体积基本在1M到5M之间，有些无法识别出来，能识别的响应也比较慢，大多超过5s）。
3. 用ajax传文件到后台要防止文件过来，传过去导致接收的数据为null。 （前后端配合的情况下才会出现。tomaca文件上传限制大小是原因之一）
请求到的结果是一个这样的情况：
![图](/images/vue/20181012-1.png)

PS：后面也尝试了许多的模板，社保卡识别，银行卡识别，学信网招聘识别。调的接口不一样而已。有些百度没有提供的模板，需要自定义。详情参考api，10分钟以内学会。

2. 人脸识别

手机随意拍一张照片，和身份证上面照片比对。拍照的图片一直比对不成功就要注意采用活体检测。
这些都要求拍出来的照片清晰度比较。
接口掉头方法类似。






